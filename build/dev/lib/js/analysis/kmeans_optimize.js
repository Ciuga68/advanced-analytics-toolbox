"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){for(var t=r.layout,s=(t.props.numberOfClusters,a.validateDimension(t.props.dimensions[0])),i=[{qDef:{qFieldDefs:[s]}}],o=t.props.measures.length,p=a.validateMeasure(t.props.measures[0])+" as mea0",n="q$mea0",l="N",u=1;u<o;u++){var q=a.validateMeasure(t.props.measures[u]);if(q.length>0){var c=","+q+" as mea"+u;p+=c,n+=",q$mea"+u,l+="N"}}var d="cbind("+n+")";t.props.scaleData&&(d="scale(cbind("+n+"))");var f="";"undefined"!=typeof t.props.optimizationMethod&&"gap"!=t.props.optimizationMethod||(f="R.ScriptEvalExStr('"+l+"','library(cluster); library(jsonlite); set.seed(1); gap_kmeans<-clusGap("+d+", FUNcluster=kmeans, K.max="+t.props.clusterMax+", B="+t.props.bootstrap+"); json<-toJSON(gap_kmeans$Tab); json;', "+p+")");var m=[{qDef:{qDef:f}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(i)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(m)}],!1),r.patchApplied=!0,null},drawChart:function(t,s){var i=r.defer(),o=t.layout,p=(a.validateDimension(o.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return t.backendApi.getData(p).then(function(r){t.layout.qHyperCube.qMeasureInfo;if(0===r[0].qMatrix[0][1].qText.length||"-"==r[0].qMatrix[0][1].qText)a.displayConnectionError(t.extId);else{var s=JSON.parse(r[0].qMatrix[0][1].qText),p=a.getOneHundredColors(),n=[],l=[],u=[];$.each(s,function(e,a){n.push(e+1),l.push(a[2]),u.push(a[3])});var q=[{x:n,y:l,name:"Gap statistic",error_y:{type:"data",symmetric:!1,array:u,arrayminus:u,thickness:o.props.borderWidth,color:o.props.colors?"rgba("+p[3]+",1)":"rgba("+p[o.props.colorForMain]+",1)"},type:"scatter",mode:"markers+lines",marker:{color:o.props.colors?"rgba("+p[3]+",1)":"rgba("+p[o.props.colorForMain]+",1)",size:o.props.pointRadius}}];$(".advanced-analytics-toolsets-"+t.extId).html('<div id="aat-chart-'+t.extId+'" style="width:100%;height:100%;"></div>'),e.draw(t,q,"aat-chart-"+t.extId,null)}return i.resolve()}),i.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans_optimize.js.map
