"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var i=r.layout,s=a.validateDimension(i.props.dimensions[0]),o=[{qDef:{qFieldDefs:[s]}}],t=a.validateMeasure(i.props.measures[0]),p=null;p=1===i.props.differencing?"R.ScriptEval('diff(na.omit(q$Measure),  "+i.props.seasonalDifferences+")', "+t+" as Measure)":2===i.props.differencing?"R.ScriptEval('diff(diff(na.omit(q$Measure), "+i.props.seasonalDifferences+"), "+i.props.firstDifferences+")', "+t+" as Measure)":t;var n="";i.props.lagMax===!1&&(n=", lag.max="+i.props.lagMaxValue+" ");var f=["acf","pacf"],l=[];$.each(f,function(e,a){1===i.props.differencing?l[a]=a+"(diff(na.omit(q$Measure), "+i.props.seasonalDifferences+"),plot=FALSE "+n+")$acf":2===i.props.differencing?l[a]=a+"(diff(diff(na.omit(q$Measure), "+i.props.seasonalDifferences+"), "+i.props.firstDifferences+"),plot=FALSE "+n+")$acf":l[a]=a+"(na.omit(q$Measure),plot=FALSE "+n+")$acf"});var c=[{qDef:{qDef:p}},{qDef:{qDef:"R.ScriptEval('"+l.acf+"', "+t+" as Measure)"}},{qDef:{qDef:"R.ScriptEval('"+l.pacf+"', "+t+" as Measure)"}},{qDef:{qDef:"R.ScriptEval('high<-qnorm((1 + 0.95)/2)/sqrt(length(q$Measure));low<-qnorm((1 - 0.95)/2)/sqrt(length(q$Measure));c(high, low)', "+t+" as Measure)"}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(c)}],!1),r.patchApplied=!0,null},drawChart:function(i,s){var o=r.defer(),t=i.layout,p=(a.validateDimension(t.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}]);return i.backendApi.getData(p).then(function(r){var p=i.layout.qHyperCube.qMeasureInfo;return isNaN(p[0].qMin)&&isNaN(p[0].qMax)&&isNaN(p[1].qMin)&&isNaN(p[1].qMax)&&isNaN(p[2].qMin)&&isNaN(p[2].qMax)&&isNaN(p[3].qMin)&&isNaN(p[3].qMax)?a.displayConnectionError(i.extId):!function(){var o=a.getDefaultPaletteColor(),p=r[0].qMatrix[0][4].qNum,n=r[0].qMatrix[1][4].qNum,f=[],l=[],c=[];if($.each(r[0].qMatrix,function(e,a){f.push(a[0].qElemNumber),l.push(a[0].qText),c.push(a[1].qNum)}),1===t.props.differencing||2===t.props.differencing)for(var u=0;u<t.props.seasonalDifferences;u++)l.shift();if(2===t.props.differencing)for(var d=0;d<t.props.firstDifferences;d++)l.shift();var q=[{x:l,y:c,elemNum:f,name:"Observed",mode:"lines+markers",fill:t.props.line,fillcolor:t.props.colors?"rgba("+o[3]+",0.3)":"rgba("+o[t.props.colorForMain]+",0.3)",marker:{color:t.props.colors?"rgba("+o[3]+",1)":"rgba("+o[t.props.colorForMain]+",1)",size:t.props.datapoints?t.props.pointRadius:1},line:{width:t.props.borderWidth},xaxis:"x",yaxis:"y"}],x=void 0,h=void 0,m=void 0,y=void 0,g=void 0,v=[];v[2]=2,v[3]=4;for(var M=function(e){x=[],h=[],m=[],y=[],g={};var a=e-2;$.each(r[0].qMatrix,function(r,i){return"-"!==i[e].qText&&(x.push(a),h.push(i[e].qNum),m.push(p),y.push(n),void a++)}),q.push({x:x,y:h,name:2===e?"Autocorrelation":"Partial Autocorrelation",marker:{color:"rgba("+o[t.props.colorForMain]+",1)"},type:"bar",width:.3,xaxis:"x"+e,yaxis:"y"+e}),q.push({x:x,y:m,name:"Upper",type:"scatter",line:{color:"rgba("+o[t.props.colorForSub]+",1)",dash:"dash"},marker:{size:1},xaxis:"x"+e,yaxis:"y"+e}),q.push({x:x,y:y,name:"Lower",type:"scatter",line:{color:"rgba("+o[t.props.colorForSub]+",1)",dash:"dash"},marker:{size:1},xaxis:"x"+e,yaxis:"y"+e})},D=2;D<4;D++)M(D);var N={xaxis:{zeroline:!1,showgrid:i.layout.props.xScale},yaxis:{domain:[.65,1],tickformat:a.getTickFormat(i,0),tickprefix:a.getPrefix(i,0),ticksuffix:a.getSuffix(i,0),showgrid:i.layout.props.yScale},xaxis2:{domain:[0,.45],anchor:"y2",showgrid:i.layout.props.xScale},yaxis2:{domain:[0,.45],anchor:"x2",showgrid:i.layout.props.yScale},xaxis3:{domain:[.55,1],anchor:"y3",showgrid:i.layout.props.xScale},yaxis3:{domain:[0,.45],anchor:"x3",showgrid:i.layout.props.yScale}};$(".advanced-analytics-toolsets-"+i.extId).html('<div id="aat-chart-'+i.extId+'" class="simple" style="width:100%;height:100%;"></div>');var b=e.draw(i,q,"aat-chart-"+i.extId,N);e.setEvents(b,i,s)}(),o.resolve()}),o.promise}}});
//# sourceMappingURL=../../maps/analysis/autocorrelation.js.map
