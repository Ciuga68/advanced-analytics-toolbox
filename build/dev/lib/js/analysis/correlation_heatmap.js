"use strict";define(["../chart/heatmap","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var t=r.layout,s=a.validateDimension(t.props.dimensions[0]),o=[{qDef:{qFieldDefs:[s]}}],i=t.props.measures.length;r.rowsLabel=[a.validateMeasure(t.props.measures[0])];for(var l=a.validateMeasure(t.props.measures[0])+" as mea0",n="q$mea0",q="N",p=1;p<i;p++){var u=a.validateMeasure(t.props.measures[p]);if(u.length>0){var f=","+u+" as mea"+p;l+=f,n+=", q$mea"+p,q+="N",r.rowsLabel.push(a.validateMeasure(t.props.measures[p]))}}var d=[{qDef:{qDef:"R.ScriptEvalExStr('"+q+"','library(jsonlite);res<-cor(data.frame("+n+"));json<-toJSON(res);json;',"+l+")"}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(d)}],!1),r.patchApplied=!0,null},drawChart:function(t){var s=r.defer(),o=t.layout,i=(a.validateDimension(o.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return t.backendApi.getData(i).then(function(r){t.layout.qHyperCube.qMeasureInfo;if(0===r[0].qMatrix[0][1].qText.length||"-"==r[0].qMatrix[0][1].qText)a.displayConnectionError(t.extId);else{var o=(a.getDefaultPaletteColor(),JSON.parse(r[0].qMatrix[0][1].qText)),i=[{x:t.rowsLabel,y:t.rowsLabel,z:o,type:"heatmap",showscale:!0}],l=[];l.annotations=[];for(var n=0;n<t.rowsLabel.length;n++)for(var q=0;q<t.rowsLabel.length;q++){var p={xref:"x1",yref:"y1",x:t.rowsLabel[q],y:t.rowsLabel[n],text:o[n][q],showarrow:!1,font:{color:"white"}};l.annotations.push(p)}$(".advanced-analytics-toolsets-"+t.extId).html('<div id="aat-chart-'+t.extId+'" style="width:100%;height:100%;"></div>'),e.draw(t,i,"aat-chart-"+t.extId,l)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/correlation_heatmap.js.map
