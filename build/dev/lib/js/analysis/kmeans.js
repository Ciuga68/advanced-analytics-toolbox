"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,t){return{createCube:function(e,t){for(var r=t.layout,s=r.props.numberOfClusters,u=a.validateDimension(r.props.dimensions[0]),n=[{qDef:{qFieldDefs:[u]}}],l=r.props.measures.length,i=a.validateMeasure(r.props.measures[0])+" as mea0",p="q$mea0",o=1;o<l;o++){var c=a.validateMeasure(r.props.measures[o]);if(c.length>0){var m=","+c+" as mea"+o;i+=m,p+=",q$mea"+o}}var d="cbind("+p+")";r.props.scaleData&&(d="scale(cbind("+p+"))");var q=a.validateMeasure(r.props.measures[0]),f=a.validateMeasure(r.props.measures[1]),h=[{qDef:{qDef:q}},{qDef:{qDef:f}},{qDef:{qDef:"R.ScriptEval('set.seed(1);kmeans("+d+","+s+")$cluster', "+i+")"}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return t.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(n)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),t.patchApplied=!0,null},drawChart:function(r,s){var u=t.defer(),n=r.layout;return a.pageExtensionData(r,function(t){var l=r.layout.qHyperCube.qMeasureInfo;if(isNaN(l[2].qMin)&&isNaN(l[2].qMax))a.displayConnectionError(r.extId);else{for(var i=(a.getOneHundredColors(),[]),p=1;p<=n.props.numberOfClusters;p++)i[p]=[],i[p].elemNum=[],i[p].text=[],i[p].x=[],i[p].y=[];$.each(t,function(e,a){i[a[3].qNum].elemNum.push(a[0].qElemNumber),i[a[3].qNum].text.push(a[0].qText),i[a[3].qNum].x.push(a[1].qNum),i[a[3].qNum].y.push(a[2].qNum)});for(var o=[],c=1;c<=n.props.numberOfClusters;c++)o.push({x:i[c].x,y:i[c].y,elemNum:i[c].elemNum,text:i[c].text,name:"cluster "+c,mode:"markers",type:"scatter",marker:{size:n.props.bubbleSize}});$(".advanced-analytics-toolsets-"+r.extId).html('<div id="aat-chart-'+r.extId+'" style="width:100%;height:100%;"></div>');var m=e.draw(r,s,o,"aat-chart-"+r.extId,null);e.setEvents(m,r,s),$("#aat-chart-"+r.extId+" .legend .traces .legendtoggle").css("display","none"),$("#aat-chart-"+r.extId+" g.traces").on("click",function(e){var a=i[e.currentTarget.childNodes[1].textContent.replace("cluster ","")].text,t=a.map(function(e){return parseInt(e,10)});s.field(r.layout.props.dimensions[0].expression).selectValues(t,!0,!0)})}return u.resolve()}),u.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans.js.map
