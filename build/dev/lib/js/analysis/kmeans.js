"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,t){return{createCube:function(e,t){for(var r=t.layout,s=r.props.numberOfClusters,n=a.validateDimension(r.props.dimensions[0]),u=[{qDef:{qFieldDefs:[n]}}],i=r.props.measures.length,l=a.validateMeasure(r.props.measures[0])+" as mea0",p="q$mea0",o=1;o<i;o++){var c=a.validateMeasure(r.props.measures[o]);if(c.length>0){var q=","+c+" as mea"+o;l+=q,p+=",q$mea"+o}}var d="cbind("+p+")";r.props.scaleData&&(d="scale(cbind("+p+"))");var m=a.validateMeasure(r.props.measures[0]),f=a.validateMeasure(r.props.measures[1]),h=[{qDef:{qDef:m}},{qDef:{qDef:f}},{qDef:{qDef:"R.ScriptEval('set.seed(1);kmeans("+d+","+s+")$cluster', "+l+")"}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return t.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(u)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),t.patchApplied=!0,null},drawChart:function(r,s){var n=t.defer(),u=r.layout,i=(a.validateDimension(u.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}]);return r.backendApi.getData(i).then(function(t){var i=r.layout.qHyperCube.qMeasureInfo;if(isNaN(i[2].qMin)&&isNaN(i[2].qMax))a.displayConnectionError(r.extId);else{for(var l=a.getOneHundredColors(),p=[],o=1;o<=u.props.numberOfClusters;o++)p[o]=[],p[o].elemNum=[],p[o].text=[],p[o].x=[],p[o].y=[];$.each(t[0].qMatrix,function(e,a){p[a[3].qNum].elemNum.push(a[0].qElemNumber),p[a[3].qNum].text.push(a[0].qText),p[a[3].qNum].x.push(a[1].qNum),p[a[3].qNum].y.push(a[2].qNum)});for(var c=[],q=1;q<=u.props.numberOfClusters;q++)c.push({x:p[q].x,y:p[q].y,elemNum:p[q].elemNum,text:p[q].text,name:"cluster "+q,mode:"markers",type:"scatter",marker:{color:"rgba("+l[q-1]+",0.7)",size:u.props.bubbleSize}});$(".advanced-analytics-toolsets-"+r.extId).html('<div id="aat-chart-'+r.extId+'" style="width:100%;height:100%;"></div>');var d=e.draw(r,s,c,"aat-chart-"+r.extId,null);e.setEvents(d,r,s),$("#aat-chart-"+r.extId+" .legend .traces .legendtoggle").css("display","none"),$("#aat-chart-"+r.extId+" g.traces").on("click",function(e){var a=p[e.currentTarget.childNodes[1].textContent.replace("cluster ","")].text,t=a.map(function(e){return parseInt(e,10)});s.field(r.layout.props.dimensions[0].expression).selectValues(t,!0,!0)})}return n.resolve()}),n.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans.js.map
