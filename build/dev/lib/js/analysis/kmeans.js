"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){for(var s=r.layout,t=s.props.numberOfClusters,u=a.validateDimension(s.props.dimensions[0]),n=[{qDef:{qFieldDefs:[u]}}],l=s.props.measures.length,p=a.validateMeasure(s.props.measures[0])+" as mea0",o="q$mea0",i=1;i<l;i++){var d=a.validateMeasure(s.props.measures[i]);if(d.length>0){var c=","+d+" as mea"+i;p+=c,o+=",q$mea"+i}}var m="cbind("+o+")";s.props.scaleData&&(m="scale(cbind("+o+"))");var q=a.validateMeasure(s.props.measures[0]),f=a.validateMeasure(s.props.measures[1]);a.displayDebugModeMessage(s.props.debugMode);var b=a.getDebugSaveDatasetScript(s.props.debugMode,"debug_kmeans.rda"),v="R.ScriptEval('"+b+" set.seed(1);kmeans("+m+","+t+")$cluster', "+p+")";a.displayRScriptsToConsole(s.props.debugMode,[v]);var h=[{qDef:{qDef:q}},{qDef:{qDef:f}},{qDef:{qDef:v}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(n)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),r.patchApplied=!0,null},drawChart:function(s,t){var u=r.defer(),n=s.layout;return a.pageExtensionData(s,function(r){var l=s.layout.qHyperCube.qMeasureInfo;if(isNaN(l[2].qMin)&&isNaN(l[2].qMax))a.displayConnectionError(s.extId);else{a.displayReturnedDatasetToConsole(n.props.debugMode,r);for(var p=(a.getOneHundredColors(),[]),o=1;o<=n.props.numberOfClusters;o++)p[o]=[],p[o].elemNum=[],p[o].text=[],p[o].x=[],p[o].y=[];$.each(r,function(e,a){p[a[3].qNum].elemNum.push(a[0].qElemNumber),p[a[3].qNum].text.push(a[0].qText),p[a[3].qNum].x.push(a[1].qNum),p[a[3].qNum].y.push(a[2].qNum)});for(var i=[],d=1;d<=n.props.numberOfClusters;d++)i.push({x:p[d].x,y:p[d].y,elemNum:p[d].elemNum,text:p[d].text,name:"cluster "+d,mode:"markers",type:"scatter",marker:{size:n.props.bubbleSize}});$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>');var c=e.draw(s,t,i,"aat-chart-"+s.extId,null);e.setEvents(c,s,t),$("#aat-chart-"+s.extId+" .legend .traces .legendtoggle").css("display","none"),$("#aat-chart-"+s.extId+" g.traces").on("click",function(e){var a=p[e.currentTarget.childNodes[1].textContent.replace("cluster ","")].text,r=a.map(function(e){return parseInt(e,10)});t.field(s.layout.props.dimensions[0].expression).selectValues(r,!0,!0)})}return u.resolve()}),u.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans.js.map
