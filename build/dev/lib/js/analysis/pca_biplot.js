"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var t=r.layout,o=a.validateDimension(t.props.dimensions[0]),s=[{qDef:{qFieldDefs:[o]}}],l=t.props.measures.length;r.rowsLabel=[a.validateMeasure(t.props.measures[0])];for(var i=a.validateMeasure(t.props.measures[0])+" as mea0",n="q$mea0",p="N",u=1;u<l;u++){var c=a.validateMeasure(t.props.measures[u]);if(c.length>0){var h=","+c+" as mea"+u;i+=h,n+=",q$mea"+u,p+="N",r.rowsLabel.push(a.validateMeasure(t.props.measures[u]))}}var f=[{qDef:{qDef:"R.ScriptEvalExStr('"+p+"','library(jsonlite); pca_result<-prcomp(data.frame("+n+"), scale = TRUE); json<-toJSON(list(summary(pca_result)$x, summary(pca_result)$rotation)); json;',"+i+")"}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(s)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(f)}],!1),r.patchApplied=!0,null},drawChart:function(t,o){var s=r.defer(),l=t.layout,i=a.validateDimension(l.props.dimensions[0]),n=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return t.backendApi.getData(n).then(function(r){t.layout.qHyperCube.qMeasureInfo;if(0===r[0].qMatrix[0][1].qText.length||"-"==r[0].qMatrix[0][1].qText)a.displayConnectionError(t.extId);else{var n=a.getDefaultPaletteColor(),p=[],u=[];$.each(r[0].qMatrix,function(e,a){p.push(a[0].qElemNumber),u.push(a[0].qText)});var c=JSON.parse(r[0].qMatrix[0][1].qText),h=c[0],f=c[1],q=[],b=[],x=[],y=[];$.each(h,function(e,a){q.push(a[0]),b.push(a[1]),x.push(Math.abs(a[0])),y.push(Math.abs(a[1]))});var d=Math.max.apply(null,x),m=Math.max.apply(null,y),g=[{x:q,y:b,xaxis:"x2",yaxis:"y2",text:u,elemNum:p,name:i,mode:"markers",type:"scatter",marker:{color:l.props.colors?"rgba("+n[3]+",0.8)":"rgba("+n[l.props.colorForMain]+",0.8)",size:l.props.bubbleSize}}],v=[],D=[],M=[],w=[];$.each(f,function(e,a){v.push(a[0]),D.push(a[1]),M.push(Math.abs(a[0])),w.push(Math.abs(a[1]))});for(var S=Math.max.apply(null,M),C=Math.max.apply(null,w),L={xaxis:{title:"PC1",titlefont:{color:"rgb(148, 103, 189)"},showgrid:t.layout.props.xScale,tickfont:{color:"rgb(148, 103, 189)"},overlaying:"x",side:"bottom",range:[S*-1*1.1,1.1*S]},yaxis:{title:"PC2",showgrid:t.layout.props.yScale,titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"left",range:[C*-1*1.1,1.1*C]},xaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"x",side:"top",range:[d*-1*1.1,1.1*d]},yaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"right",range:[m*-1*1.1,1.1*m]},margin:{r:50,l:50,t:50,b:50},annotations:[]},k=0;k<t.rowsLabel.length;k++)L.annotations.push({x:v[k],y:D[k],xref:"x",yref:"y",ax:0,ay:0,axref:"x",ayref:"y",showarrow:!0,arrowcolor:"rgba("+n[l.props.colorForSub]+",1)",arrowhead:3},{x:v[k],y:D[k],text:t.rowsLabel[k],font:{color:"rgba("+n[l.props.colorForSub]+",1)"},showarrow:!1});$(".advanced-analytics-toolsets-"+t.extId).html('<div id="aat-chart-'+t.extId+'" style="width:100%;height:100%;"></div>');var N=e.draw(t,o,g,"aat-chart-"+t.extId,L);e.setEvents(N,t,o)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/pca_biplot.js.map
