"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(a,e,r){return{createCube:function(a,r){var t=r.layout,o=e.validateDimension(t.props.dimensions[0]),s=[{qDef:{qFieldDefs:[o]}}],i=t.props.measures.length;r.rowsLabel=[e.validateMeasure(t.props.measures[0])];for(var l=e.validateMeasure(t.props.measures[0])+" as mea0",p="q$mea0",n="N",u=1;u<i;u++){var y=e.validateMeasure(t.props.measures[u]);if(y.length>0){var c=","+y+" as mea"+u;l+=c,p+=",q$mea"+u,n+="N",r.rowsLabel.push(e.validateMeasure(t.props.measures[u]))}}var h=[{qDef:{qDef:"R.ScriptEvalExStr('"+n+"','library(jsonlite); pca_result<-prcomp(data.frame("+p+"), scale = TRUE); json<-toJSON(list(summary(pca_result)$x, summary(pca_result)$rotation)); json;',"+l+")"}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(s)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),r.patchApplied=!0,null},drawChart:function(t,o){var s=r.defer(),i=t.layout,l=e.validateDimension(i.props.dimensions[0]),p=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return t.backendApi.getData(p).then(function(r){t.layout.qHyperCube.qMeasureInfo;if(0===r[0].qMatrix[0][1].qText.length||"-"==r[0].qMatrix[0][1].qText)e.displayConnectionError(t.extId);else{var p=e.getDefaultPaletteColor(),n=[],u=[];$.each(r[0].qMatrix,function(a,e){n.push(e[0].qElemNumber),u.push(e[0].qText)});var y=JSON.parse(r[0].qMatrix[0][1].qText),c=y[0],h=y[1],f=[],m=[],x=[],g=[];$.each(c,function(a,e){f.push(e[0]),m.push(e[1]),x.push(Math.abs(e[0])),g.push(Math.abs(e[1]))});var q=Math.max.apply(null,x),b=Math.max.apply(null,g),d=[{x:f,y:m,xaxis:"x2",yaxis:"y2",text:u,elemNum:n,name:l,mode:"markers",type:"scatter",marker:{color:i.props.colors?"rgba("+p[3]+",0.8)":"rgba("+p[i.props.colorForMain]+",0.8)",size:i.props.bubbleSize}}],v=[],D=[],M=[],w=[];$.each(h,function(a,e){v.push(e[0]),D.push(e[1]),M.push(Math.abs(e[0])),w.push(Math.abs(e[1]))});for(var L=Math.max.apply(null,M),S=Math.max.apply(null,w),P={xaxis:{title:"PC1",titlefont:{color:"rgb(148, 103, 189)"},showgrid:t.layout.props.xScale,tickfont:{color:"rgb(148, 103, 189)"},overlaying:"x",side:"bottom",range:[L*-1*1.1,1.1*L]},yaxis:{title:"PC2",showgrid:t.layout.props.yScale,titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"left",range:[S*-1*1.1,1.1*S]},xaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"x",side:"top",range:[q*-1*1.1,1.1*q]},yaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"right",range:[b*-1*1.1,1.1*b]},margin:{r:"right"==t.layout.props.yAxisPosition?t.layout.props.marginRight+70:t.layout.props.marginRight,l:"left"==t.layout.props.yAxisPosition?t.layout.props.marginLeft+70:t.layout.props.marginLeft,t:"top"==t.layout.props.xAxisPosition?t.layout.props.marginTop+70:t.layout.props.marginTop,b:"bottom"==t.layout.props.xAxisPosition?t.layout.props.marginBottom+70:t.layout.props.marginBottom},annotations:[]},C=0;C<t.rowsLabel.length;C++)P.annotations.push({x:v[C],y:D[C],xref:"x",yref:"y",ax:0,ay:0,axref:"x",ayref:"y",showarrow:!0,arrowcolor:"rgba("+p[i.props.colorForSub]+",1)",arrowhead:3},{x:v[C],y:D[C],text:t.rowsLabel[C],font:{color:"rgba("+p[i.props.colorForSub]+",1)"},showarrow:!1});$(".advanced-analytics-toolsets-"+t.extId).html('<div id="aat-chart-'+t.extId+'" style="width:100%;height:100%;"></div>');var k=a.draw(t,o,d,"aat-chart-"+t.extId,P);a.setEvents(k,t,o)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/pca_biplot.js.map
