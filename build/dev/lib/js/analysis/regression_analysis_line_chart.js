"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,r,s){return{createCube:function(e,s){var a=s.layout,o=r.validateDimension(a.props.dimensions[0]),t=[{qDef:{qFieldDefs:[o],qSortCriterias:[{qSortByExpression:a.props.dimSort||!a.props.dimSortByExpression?0:a.props.dimSortByExpressionAsc,qSortByNumeric:a.props.dimSort?1:a.props.dimSortByNum?a.props.dimSortByNumAsc:0,qSortByAscii:a.props.dimSort||!a.props.dimSortByAlph?0:a.props.dimSortByAlphAsc,qExpression:{qv:a.props.dimSortByExpressionString}}]}}],p=a.props.measures.length;s.rowsLabel=["(Intercept)",r.validateMeasure(a.props.measures[1])];for(var i=r.validateMeasure(a.props.measures[0])+" as mea0, "+r.validateMeasure(a.props.measures[1])+" as mea1",l="q$mea0 ~ q$mea1",n=2;n<p;n++){var u=r.validateMeasure(a.props.measures[n]);if(u.length>0){var m=","+u+" as mea"+n;i+=m,l+=" + q$mea"+n,s.rowsLabel.push(r.validateMeasure(a.props.measures[n]))}}var d=r.validateMeasure(a.props.measures[0]),c=[{qDef:{qDef:d}},{qDef:{qDef:"R.ScriptEval('lm_result <- lm("+l+');predict(lm_result, interval="'+a.props.interval+'", level='+a.props.confidenceLevel+")[,1]',"+i+")"}},{qDef:{qDef:"R.ScriptEval('lm_result <- lm("+l+');predict(lm_result, interval="'+a.props.interval+'", level='+a.props.confidenceLevel+")[,2]',"+i+")"}},{qDef:{qDef:"R.ScriptEval('lm_result <- lm("+l+');predict(lm_result, interval="'+a.props.interval+'", level='+a.props.confidenceLevel+")[,3]',"+i+")"}},{qDef:{qLabel:"-",qDef:""}}];return s.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(t)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(c)}],!1),s.patchApplied=!0,null},drawChart:function(a,o){var t=s.defer(),p=a.layout,i=(r.validateDimension(p.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}]);return a.backendApi.getData(i).then(function(s){var i=a.layout.qHyperCube.qMeasureInfo;if(isNaN(i[1].qMin)&&isNaN(i[1].qMax)&&isNaN(i[2].qMin)&&isNaN(i[2].qMax)&&isNaN(i[3].qMin)&&isNaN(i[3].qMax))r.displayConnectionError(a.extId);else{var l=r.getDefaultPaletteColor(),n=[],u=[],m=[],d=[],c=[],q=[];$.each(s[0].qMatrix,function(e,r){n.push(r[0].qElemNumber),u.push(r[0].qText),m.push(r[1].qNum),d.push(r[2].qNum),c.push(r[3].qNum),q.push(r[4].qNum)});var v=[{x:u,y:m,elemNum:n,name:"Observed",mode:"lines+markers",fill:p.props.line,fillcolor:p.props.colors?"rgba("+l[3]+",0.3)":"rgba("+l[p.props.colorForMain]+",0.3)",marker:{color:p.props.colors?"rgba("+l[3]+",1)":"rgba("+l[p.props.colorForMain]+",1)",size:p.props.datapoints?p.props.pointRadius:1},line:{width:p.props.borderWidth}},{x:u,y:d,name:"Fit",line:{color:"rgba("+l[p.props.colorForSub]+",1)"}},{x:u,y:c,name:"Lower",fill:"tonexty",fillcolor:"rgba("+l[p.props.colorForSub]+",0.3)",type:"scatter",mode:"none"},{x:u,y:q,name:"Upper",fill:"tonexty",fillcolor:"rgba("+l[p.props.colorForSub]+",0.3)",type:"scatter",mode:"none"}];$(".advanced-analytics-toolsets-"+a.extId).html('<div id="aat-chart-'+a.extId+'" style="width:100%;height:100%;"></div>');var f=e.draw(a,v,"aat-chart-"+a.extId,null);e.setEvents(f,a,o)}return t.resolve()}),t.promise}}});
//# sourceMappingURL=../../maps/analysis/regression_analysis_line_chart.js.map
