"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var t=r.layout,o=a.validateDimension(t.props.dimensions[0]),i=[{qDef:{qFieldDefs:[o]}}],s=a.validateMeasure(t.props.measures[0]),p=[{qDef:{qDef:s}},{qDef:{qDef:"R.ScriptEval('library(dplyr);data<-ts(q$Measure,frequency="+t.props.frequency+");(decompose(data)$trend);', "+s+" as Measure)"}},{qDef:{qDef:"R.ScriptEval('library(dplyr);data<-ts(q$Measure,frequency="+t.props.frequency+");(decompose(data)$seasonal);', "+s+" as Measure)"}},{qDef:{qDef:"R.ScriptEval('library(dplyr);data<-ts(q$Measure,frequency="+t.props.frequency+");(decompose(data)$random);', "+s+" as Measure)"}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(i)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(p)}],!1),r.patchApplied=!0,null},drawChart:function(t,o){var i=r.defer(),s=t.layout,p=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return t.backendApi.getData(p).then(function(r){var p=t.layout.qHyperCube.qMeasureInfo;return isNaN(p[1].qMin)&&isNaN(p[1].qMax)&&isNaN(p[2].qMin)&&isNaN(p[2].qMax)&&isNaN(p[3].qMin)&&isNaN(p[3].qMax)?a.displayConnectionError(t.extId):!function(){for(var i=void 0,p=void 0,n=void 0,l=a.getDefaultPaletteColor(),u=[],c=function(e){i=[],p=[],n=[],$.each(r[0].qMatrix,function(a,r){i.push(r[0].qElemNumber),p.push(r[0].qText),n.push(r[e].qNum)});var a={x:p,y:n,elemNum:i,name:1===e?"Observed":2===e?"Trend":3===e?"Seasonal":4===e?"Random":"",mode:"lines+markers",fill:s.props.line,fillcolor:s.props.colors?"rgba("+l[3]+",0.3)":"rgba("+l[s.props.colorForMain]+",0.3)",marker:{color:s.props.colors?"rgba("+l[3]+",1)":"rgba("+l[s.props.colorForMain]+",1)",size:s.props.datapoints?s.props.pointRadius:1},line:{width:s.props.borderWidth}};s.props.decomposeInFourCharts&&4!=e&&(a.xaxis="x",a.yaxis="y"+(5-e)),u.push(a)},d=1;d<5;d++)c(d);$(".advanced-analytics-toolsets-"+t.extId).html('<div id="aat-chart-'+t.extId+'" style="width:100%;height:100%;"></div>');var f="";if(s.props.decomposeInFourCharts){var y={showlegend:t.layout.props.showLegend,xaxis:{showgrid:t.layout.props.xScale},yaxis:{title:"Random",domain:[0,.24],showgrid:t.layout.props.yScale,tickformat:a.getTickFormat(t,0),tickprefix:a.getPrefix(t,0),ticksuffix:a.getSuffix(t,0)},yaxis2:{title:"Seasonal",domain:[.25,.49],anchor:"x2",showgrid:t.layout.props.yScale,tickformat:a.getTickFormat(t,0),tickprefix:a.getPrefix(t,0),ticksuffix:a.getSuffix(t,0)},yaxis3:{title:"Trend",domain:[.5,.74],anchor:"x3",showgrid:t.layout.props.yScale,tickformat:a.getTickFormat(t,0),tickprefix:a.getPrefix(t,0),ticksuffix:a.getSuffix(t,0)},yaxis4:{title:"Observed",domain:[.74,1],anchor:"x4",showgrid:t.layout.props.yScale,tickformat:a.getTickFormat(t,0),tickprefix:a.getPrefix(t,0),ticksuffix:a.getSuffix(t,0)},dragmode:"select",margin:{r:"right"==t.layout.props.yAxisPosition?t.layout.props.marginRight+70:t.layout.props.marginRight,l:"left"==t.layout.props.yAxisPosition?t.layout.props.marginLeft+70:t.layout.props.marginLeft,t:"top"==t.layout.props.xAxisPosition?t.layout.props.marginTop+70:t.layout.props.marginTop,b:"bottom"==t.layout.props.xAxisPosition?t.layout.props.marginBottom+70:t.layout.props.marginBottom}};f=e.draw(t,u,"aat-chart-"+t.extId,y)}else f=e.draw(t,u,"aat-chart-"+t.extId,null);e.setEvents(f,t,o)}(),i.resolve()}),i.promise}}});
//# sourceMappingURL=../../maps/analysis/timeseries_decomposition.js.map
