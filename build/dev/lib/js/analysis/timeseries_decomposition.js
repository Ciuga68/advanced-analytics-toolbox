"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var t=r.layout,i=a.validateDimension(t.props.dimensions[0]),o=[{qDef:{qFieldDefs:[i]}}],s=a.validateMeasure(t.props.measures[0]),p=[{qDef:{qDef:s}},{qDef:{qDef:"R.ScriptEval('library(dplyr);data<-ts(q$Measure,frequency="+t.props.frequency+");(decompose(data)$trend);', "+s+" as Measure)"}},{qDef:{qDef:"R.ScriptEval('library(dplyr);data<-ts(q$Measure,frequency="+t.props.frequency+");(decompose(data)$seasonal);', "+s+" as Measure)"}},{qDef:{qDef:"R.ScriptEval('library(dplyr);data<-ts(q$Measure,frequency="+t.props.frequency+");(decompose(data)$random);', "+s+" as Measure)"}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(p)}],!1),r.patchApplied=!0,null},drawChart:function(t,i){var o=r.defer(),s=t.layout,p=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return t.backendApi.getData(p).then(function(r){var p=t.layout.qHyperCube.qMeasureInfo;return isNaN(p[1].qMin)&&isNaN(p[1].qMax)&&isNaN(p[2].qMin)&&isNaN(p[2].qMax)&&isNaN(p[3].qMin)&&isNaN(p[3].qMax)?a.displayConnectionError(t.extId):!function(){for(var o=void 0,p=void 0,n=void 0,l=a.getDefaultPaletteColor(),c=[],d=function(e){o=[],p=[],n=[],$.each(r[0].qMatrix,function(a,r){o.push(r[0].qElemNumber),p.push(r[0].qText),n.push(r[e].qNum)});var a={x:p,y:n,elemNum:o,name:1===e?"Observed":2===e?"Trend":3===e?"Seasonal":4===e?"Random":"",mode:"lines+markers",fill:s.props.line,fillcolor:s.props.colors?"rgba("+l[3]+",0.3)":"rgba("+l[s.props.colorForMain]+",0.3)",marker:{color:s.props.colors?"rgba("+l[3]+",1)":"rgba("+l[s.props.colorForMain]+",1)",size:s.props.datapoints?s.props.pointRadius:1},line:{width:s.props.borderWidth}};s.props.decomposeInFourCharts&&4!=e&&(a.xaxis="x",a.yaxis="y"+(5-e)),c.push(a)},f=1;f<5;f++)d(f);$(".advanced-analytics-toolsets-"+t.extId).html('<div id="aat-chart-'+t.extId+'" style="width:100%;height:100%;"></div>');var u="";if(s.props.decomposeInFourCharts){var q={showlegend:t.layout.props.showLegend,xaxis:{showgrid:t.layout.props.xScale},yaxis:{title:"Random",domain:[0,.24],showgrid:t.layout.props.yScale,tickformat:a.getTickFormat(t,0),tickprefix:a.getPrefix(t,0),ticksuffix:a.getSuffix(t,0)},yaxis2:{title:"Seasonal",domain:[.25,.49],anchor:"x2",showgrid:t.layout.props.yScale,tickformat:a.getTickFormat(t,0),tickprefix:a.getPrefix(t,0),ticksuffix:a.getSuffix(t,0)},yaxis3:{title:"Trend",domain:[.5,.74],anchor:"x3",showgrid:t.layout.props.yScale,tickformat:a.getTickFormat(t,0),tickprefix:a.getPrefix(t,0),ticksuffix:a.getSuffix(t,0)},yaxis4:{title:"Observed",domain:[.74,1],anchor:"x4",showgrid:t.layout.props.yScale,tickformat:a.getTickFormat(t,0),tickprefix:a.getPrefix(t,0),ticksuffix:a.getSuffix(t,0)},dragmode:"select",margin:{r:10,t:0}};u=e.draw(t,c,"aat-chart-"+t.extId,q)}else u=e.draw(t,c,"aat-chart-"+t.extId,null);e.setEvents(u,t,i)}(),o.resolve()}),o.promise}}});
//# sourceMappingURL=../../maps/analysis/timeseries_decomposition.js.map
