"use strict";define(["../chart/bubble_3d_chart","../util/utils","ng!$q"],function(a,e,r){return{createCube:function(a,r){var t=r.layout,o=e.validateDimension(t.props.dimensions[0]),s=[{qDef:{qFieldDefs:[o]}}],l=t.props.measures.length;r.rowsLabel=[e.validateMeasure(t.props.measures[0])];for(var i=e.validateMeasure(t.props.measures[0])+" as mea0",n="q$mea0",p="N",u=1;u<l;u++){var h=e.validateMeasure(t.props.measures[u]);if(h.length>0){var c=","+h+" as mea"+u;i+=c,n+=",q$mea"+u,p+="N",r.rowsLabel.push(e.validateMeasure(t.props.measures[u]))}}var f=[{qDef:{qDef:"R.ScriptEvalExStr('"+p+"','library(jsonlite); pca_result<-prcomp(data.frame("+n+"), scale = TRUE); json<-toJSON(list(summary(pca_result)$x, summary(pca_result)$rotation)); json;',"+i+")"}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(s)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(f)}],!1),r.patchApplied=!0,null},drawChart:function(t,o){var s=r.defer(),l=t.layout,i=e.validateDimension(l.props.dimensions[0]),n=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return t.backendApi.getData(n).then(function(r){t.layout.qHyperCube.qMeasureInfo;if(0===r[0].qMatrix[0][1].qText.length||"-"==r[0].qMatrix[0][1].qText)e.displayConnectionError(t.extId);else{var n=e.getDefaultPaletteColor(),p=[];$.each(r[0].qMatrix,function(a,e){p.push(e[0].qText)});var u=JSON.parse(r[0].qMatrix[0][1].qText),h=u[0],c=u[1],f=[],y=[],x=[],b=[],d=[],g=[];$.each(h,function(a,e){f.push(e[0]),y.push(e[1]),x.push(e[2]),b.push(Math.abs(e[0])),d.push(Math.abs(e[1])),g.push(Math.abs(e[2]))});var q=Math.max.apply(null,b),m=Math.max.apply(null,d),v=Math.max.apply(null,g),M=[{x:f,y:y,z:x,xaxis:"x2",yaxis:"y2",zaxis:"z2",text:p,name:i,mode:"markers",type:"scatter3d",marker:{size:l.props.bubbleSize,opacity:.8,line:{width:1}}}],D=[],w=[],z=[],S=[],k=[],C=[];$.each(c,function(a,e){D.push(e[0]),w.push(e[1]),z.push(e[2]),S.push(Math.abs(e[0])),k.push(Math.abs(e[1])),C.push(Math.abs(e[2]))});for(var L=Math.max.apply(null,S),P=Math.max.apply(null,k),N=Math.max.apply(null,C),O={xaxis:{title:"PC1",titlefont:{color:"rgb(148, 103, 189)"},showgrid:t.layout.props.xScale,tickfont:{color:"rgb(148, 103, 189)"},overlaying:"x",side:"bottom",range:[L*-1*1.1,1.1*L]},yaxis:{title:"PC2",showgrid:t.layout.props.yScale,titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"left",range:[P*-1*1.1,1.1*P]},zaxis:{title:"PC3",showgrid:t.layout.props.zScale,titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"z",side:"left",range:[N*-1*1.1,1.1*N]},xaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"x",side:"top",range:[q*-1*1.1,1.1*q]},yaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"right",range:[m*-1*1.1,1.1*m]},zaxis2:{titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"z",side:"right",range:[v*-1*1.1,1.1*v]},margin:{r:50,l:50,t:50,b:50},annotations:[]},T=0;T<t.rowsLabel.length;T++)O.annotations.push({x:D[T],y:w[T],z:z[T],xref:"x",yref:"y",zref:"z",ax:0,ay:0,az:0,axref:"x",ayref:"y",azref:"y",showarrow:!0,arrowcolor:"rgba("+n[l.props.colorForSub]+",1)",arrowhead:3},{x:D[T],y:w[T],z:z[T],text:t.rowsLabel[T],font:{color:"rgba("+n[l.props.colorForSub]+",1)"},showarrow:!1});$(".advanced-analytics-toolsets-"+t.extId).html('<div id="aat-chart-'+t.extId+'" style="width:100%;height:100%;"></div>'),a.draw(t,o,M,"aat-chart-"+t.extId,null)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/pca_biplot_3d.js.map
