"use strict";define(["../chart/line_chart","../chart/datatables","../util/utils","ng!$q","../../vendor/d3-format.min"],function(e,r,t,a,o){return{createCube:function(e,r){var a=r.layout,o=t.validateDimension(a.props.dimensions[0]),s=[{qDef:{qFieldDefs:[o],qSortCriterias:[{qSortByExpression:a.props.dimSort||!a.props.dimSortByExpression?0:a.props.dimSortByExpressionAsc,qSortByNumeric:a.props.dimSort?1:a.props.dimSortByNum?a.props.dimSortByNumAsc:0,qSortByAscii:a.props.dimSort||!a.props.dimSortByAlph?0:a.props.dimSortByAlphAsc,qExpression:{qv:a.props.dimSortByExpressionString}}]}}],i=t.validateMeasure(a.props.measures[0]);t.displayDebugModeMessage(a.props.debugMode);var l=t.getDebugSaveDatasetScript(a.props.debugMode,"debug_simple_linear_line.rda"),p="R.ScriptEval('"+l+' lm_result <- lm(q$Measure~q$Dimension);predict(lm_result, interval="'+a.props.interval+'", level='+a.props.confidenceLevel+")[,1]',"+o+" as Dimension, "+i+" as Measure)",n="R.ScriptEval('lm_result <- lm(q$Measure~q$Dimension);predict(lm_result, interval=\""+a.props.interval+'", level='+a.props.confidenceLevel+")[,2]',"+o+" as Dimension, "+i+" as Measure)",u="R.ScriptEval('lm_result <- lm(q$Measure~q$Dimension);predict(lm_result, interval=\""+a.props.interval+'", level='+a.props.confidenceLevel+")[,3]',"+o+" as Dimension, "+i+" as Measure)";t.displayRScriptsToConsole(a.props.debugMode,[p,n,u]);var d=[{qDef:{qDef:i}},{qDef:{qLabel:"Fit",qDef:p}},{qDef:{qLabel:"Lower",qDef:n}},{qDef:{qLabel:"Upper",qDef:u}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(s)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(d)}],!1),r.patchApplied=!0,null},drawChart:function(o,s){var i=a.defer(),l=o.layout,p=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return o.backendApi.getData(p).then(function(a){var p=o.layout.qHyperCube.qMeasureInfo;if(isNaN(p[1].qMin)&&isNaN(p[1].qMax)&&isNaN(p[2].qMin)&&isNaN(p[2].qMax)&&isNaN(p[3].qMin)&&isNaN(p[3].qMax))t.displayConnectionError(o.extId);else{t.displayReturnedDatasetToConsole(l.props.debugMode,a[0]);var n=t.getDefaultPaletteColor();if("undefined"==typeof o.layout.props.displayTable||0==o.layout.props.displayTable){var u=[],d=[],m=[],q=[],c=[],f=[];$.each(a[0].qMatrix,function(e,r){u.push(r[0].qElemNumber),d.push(r[0].qText),m.push(r[1].qNum),q.push(r[2].qNum),c.push(r[3].qNum),f.push(r[4].qNum)});var h=[{x:d,y:m,elemNum:u,name:"Observed",mode:"lines+markers",fill:l.props.line,fillcolor:l.props.colors?"rgba("+n[3]+",0.3)":"rgba("+n[l.props.colorForMain]+",0.3)",marker:{color:l.props.colors?"rgba("+n[3]+",1)":"rgba("+n[l.props.colorForMain]+",1)",size:l.props.datapoints?l.props.pointRadius:1},line:{width:l.props.borderWidth}},{x:d,y:q,name:"Fit",line:{color:"rgba("+n[l.props.colorForSub]+",1)"}},{x:d,y:c,name:"Lower",fill:"tonexty",fillcolor:"rgba("+n[l.props.colorForSub]+",0.3)",type:"scatter",mode:"none"},{x:d,y:f,name:"Upper",fill:"tonexty",fillcolor:"rgba("+n[l.props.colorForSub]+",0.3)",type:"scatter",mode:"none"}];$(".advanced-analytics-toolsets-"+o.extId).html('<div id="aat-chart-'+o.extId+'" style="width:100%;height:100%;"></div>');var b=e.draw(o,h,"aat-chart-"+o.extId,null);e.setEvents(b,o,s)}else{var y=t.getLocale(o,0),v=t.getNumberFormat(o,0),N=[];$.each(a[0].qMatrix,function(e,r){N.push([r[0].qElemNumber,r[0].qText,y.format(v)(r[1].qNum).replace(/G/,"B"),y.format(v)(r[2].qNum).replace(/G/,"B"),y.format(v)(r[3].qNum).replace(/G/,"B"),y.format(v)(r[4].qNum).replace(/G/,"B")])});var D='\n              <table id="aat-table-'+o.extId+'" class="display">\n                <thead>\n                  <tr>\n                    <th>qElemNumber</th>\n                    <th>'+o.layout.props.dimensions[0].label+"</th>\n                    <th>"+o.layout.props.measures[0].label+"</th>\n                    <th>Fit</th>\n                    <th>Lower</th>\n                    <th>Upper</th>\n                  </tr>\n                </thead>\n                <tbody>\n                </tbody>\n              </table>";r.draw(s,o,"#aat-table-"+o.extId,N,D,null).then(function(e){r.setEvents(e,o,s)})}}return i.resolve()}),i.promise}}});
//# sourceMappingURL=../../maps/analysis/simple_linear_line.js.map
