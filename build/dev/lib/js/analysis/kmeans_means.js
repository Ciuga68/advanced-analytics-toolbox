"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,t){return{createCube:function(e,t){for(var r=t.layout,s=r.props.numberOfClusters,i=a.validateDimension(r.props.dimensions[0]),o=[{qDef:{qFieldDefs:[i]}}],l=r.props.measures.length,n=a.validateMeasure(r.props.measures[0])+" as mea0",p="q$mea0",u="N",d=1;d<l;d++){var c=a.validateMeasure(r.props.measures[d]);if(c.length>0){var f=","+c+" as mea"+d;n+=f,p+=",q$mea"+d,u+="N"}}var q="cbind("+p+")";r.props.scaleData&&(q="scale(cbind("+p+"))");var h=[{qDef:{qDef:"R.ScriptEvalExStr('"+u+"', 'library(jsonlite); set.seed(1); json<-toJSON(kmeans("+q+","+s+")$centers); json;', "+n+")"}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return t.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),t.patchApplied=!0,null},drawChart:function(r,s){var i=t.defer(),o=r.layout,l=(a.validateDimension(o.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return r.backendApi.getData(l).then(function(t){if(0===t[0].qMatrix[0][1].qText.length||"-"==t[0].qMatrix[0][1].qText)a.displayConnectionError(r.extId);else{for(var l=JSON.parse(t[0].qMatrix[0][1].qText),n=(a.getOneHundredColors(),o.props.measures.length),p=[],u=0;u<n;u++)p.push(o.props.measures[u].label);var d=[],c={xaxis:{title:r.layout.props.xLabelsAndTitle?"Variables":"",showgrid:r.layout.props.xScale,side:r.layout.props.xAxisPosition},yaxis:{title:r.layout.props.yLabelsAndTitle?"Y":"",showgrid:r.layout.props.yScale,side:r.layout.props.yAxisPosition,tickformat:a.getTickFormat(r,0),tickprefix:a.getPrefix(r,0),ticksuffix:a.getSuffix(r,0)},barmode:"group"};if("undefined"==typeof r.layout.props.dividedBy||"variables"===r.layout.props.dividedBy)$.each(l,function(e,a){d.push({x:p,y:a,name:"cluster "+e,type:"bar"})});else{for(var f=[],q=1;q<=o.props.numberOfClusters;q++)f.push("cluster "+q);for(var h=[],y=0;y<n;y++)h[y]=[];$.each(l,function(e,a){$.each(a,function(e,a){h[e].push(a)})});for(var x=0;x<n;x++)d.push({x:f,y:h[x],name:p[x],type:"bar"});c.xaxis.title=r.layout.props.xLabelsAndTitle?"Clusters":""}$(".advanced-analytics-toolsets-"+r.extId).html('<div id="aat-chart-'+r.extId+'" style="width:100%;height:100%;"></div>'),e.draw(r,s,d,"aat-chart-"+r.extId,c),$("#aat-chart-"+r.extId+" .legend .traces .legendtoggle").css("display","none"),$("#aat-chart-"+r.extId+" g.traces").on("click",function(e){})}return i.resolve()}),i.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans_means.js.map
