"use strict";define(["../chart/bubble_chart","../util/utils","ng!$q"],function(e,a,t){return{createCube:function(e,t){for(var s=t.layout,r=s.props.numberOfClusters,i=a.validateDimension(s.props.dimensions[0]),o=[{qDef:{qFieldDefs:[i]}}],p=s.props.measures.length,l=a.validateMeasure(s.props.measures[0])+" as mea0",n="q$mea0",d="N",u=1;u<p;u++){var c=a.validateMeasure(s.props.measures[u]);if(c.length>0){var f=","+c+" as mea"+u;l+=f,n+=",q$mea"+u,d+="N"}}var q="cbind("+n+")";s.props.scaleData&&(q="scale(cbind("+n+"))"),a.displayDebugModeMessage(s.props.debugMode);var y=a.getDebugSaveDatasetScript(s.props.debugMode,"debug_kmeans_means.rda"),b="R.ScriptEvalExStr('"+d+"', '"+y+" library(jsonlite); set.seed(1); json<-toJSON(kmeans("+q+","+r+")$centers); json;', "+l+")";a.displayRScriptsToConsole(s.props.debugMode,[b]);var h=[{qDef:{qDef:b}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return t.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),t.patchApplied=!0,null},drawChart:function(s,r){var i=t.defer(),o=s.layout,p=(a.validateDimension(o.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return s.backendApi.getData(p).then(function(t){if(0===t[0].qMatrix[0][1].qText.length||"-"==t[0].qMatrix[0][1].qText)a.displayConnectionError(s.extId);else{a.displayReturnedDatasetToConsole(o.props.debugMode,t[0]);for(var p=JSON.parse(t[0].qMatrix[0][1].qText),l=(a.getOneHundredColors(),o.props.measures.length),n=[],d=0;d<l;d++)n.push(o.props.measures[d].label);var u=[],c={xaxis:{title:s.layout.props.xLabelsAndTitle?"Variables":"",showgrid:s.layout.props.xScale,side:s.layout.props.xAxisPosition},yaxis:{title:s.layout.props.yLabelsAndTitle?"Y":"",showgrid:s.layout.props.yScale,side:s.layout.props.yAxisPosition,tickformat:a.getTickFormat(s,0),tickprefix:a.getPrefix(s,0),ticksuffix:a.getSuffix(s,0)},barmode:"group"};if("undefined"==typeof s.layout.props.dividedBy||"variables"===s.layout.props.dividedBy)$.each(p,function(e,a){u.push({x:n,y:a,name:"cluster "+(e+1),type:"bar"})});else{for(var f=[],q=1;q<=o.props.numberOfClusters;q++)f.push("cluster "+q);for(var y=[],b=0;b<l;b++)y[b]=[];$.each(p,function(e,a){$.each(a,function(e,a){y[e].push(a)})});for(var h=0;h<l;h++)u.push({x:f,y:y[h],name:n[h],type:"bar"});c.xaxis.title=s.layout.props.xLabelsAndTitle?"Clusters":""}$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>'),e.draw(s,r,u,"aat-chart-"+s.extId,c),$("#aat-chart-"+s.extId+" .legend .traces .legendtoggle").css("display","none"),$("#aat-chart-"+s.extId+" g.traces").on("click",function(e){})}return i.resolve()}),i.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans_means.js.map
