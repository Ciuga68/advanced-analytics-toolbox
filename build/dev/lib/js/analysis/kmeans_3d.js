"use strict";define(["../chart/bubble_3d_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){for(var s=r.layout,t=s.props.numberOfClusters,u=a.validateDimension(s.props.dimensions[0]),p=[{qDef:{qFieldDefs:[u]}}],i=s.props.measures.length,o=a.validateMeasure(s.props.measures[0])+" as mea0",n="q$mea0",d=1;d<i;d++){var l=a.validateMeasure(s.props.measures[d]);if(l.length>0){var q=","+l+" as mea"+d;o+=q,n+=",q$mea"+d}}var c="cbind("+n+")";s.props.scaleData&&(c="scale(cbind("+n+"))");var m=a.validateMeasure(s.props.measures[0]),f=a.validateMeasure(s.props.measures[1]),b=a.validateMeasure(s.props.measures[2]);a.displayDebugModeMessage(s.props.debugMode);var v=a.getDebugSaveDatasetScript(s.props.debugMode,"debug_kmeans_3d.rda"),D="R.ScriptEval('"+v+" set.seed(1);kmeans("+c+","+t+")$cluster', "+o+")";a.displayRScriptsToConsole(s.props.debugMode,[D]);var h=[{qDef:{qDef:m}},{qDef:{qDef:f}},{qDef:{qDef:b}},{qDef:{qDef:D}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(p)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),r.patchApplied=!0,null},drawChart:function(s,t){var u=r.defer(),p=s.layout;a.validateDimension(p.props.dimensions[0]);return a.pageExtensionData(s,function(r){var i=s.layout.qHyperCube.qMeasureInfo;if(isNaN(i[3].qMin)&&isNaN(i[3].qMax))a.displayConnectionError(s.extId);else{a.displayReturnedDatasetToConsole(p.props.debugMode,r);for(var o=a.getOneHundredColors(),n=[],d=1;d<=p.props.numberOfClusters;d++)n[d]=[],n[d].text=[],n[d].x=[],n[d].y=[],n[d].z=[];$.each(r,function(e,a){n[a[4].qNum].text.push(a[0].qText),n[a[4].qNum].x.push(a[1].qNum),n[a[4].qNum].y.push(a[2].qNum),n[a[4].qNum].z.push(a[3].qNum)});for(var l=[],q=1;q<=p.props.numberOfClusters;q++)l.push({x:n[q].x,y:n[q].y,z:n[q].z,text:n[q].text,name:"cluster "+q,mode:"markers",type:"scatter3d",marker:{color:"rgba("+o[q-1]+",0.7)",size:p.props.bubbleSize,opacity:.8,line:{color:"rgba("+o[q-1]+", 1)",width:1}}});$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>'),e.draw(s,t,l,"aat-chart-"+s.extId,null)}return u.resolve()}),u.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans_3d.js.map
