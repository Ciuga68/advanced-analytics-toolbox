"use strict";define(["../chart/bubble_3d_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){for(var s=r.layout,t=s.props.numberOfClusters,u=a.validateDimension(s.props.dimensions[0]),i=[{qDef:{qFieldDefs:[u]}}],n=s.props.measures.length,p=a.validateMeasure(s.props.measures[0])+" as mea0",l="q$mea0",o=1;o<n;o++){var q=a.validateMeasure(s.props.measures[o]);if(q.length>0){var d=","+q+" as mea"+o;p+=d,l+=",q$mea"+o}}var f="cbind("+l+")";s.props.scaleData&&(f="scale(cbind("+l+"))");var m=a.validateMeasure(s.props.measures[0]),c=a.validateMeasure(s.props.measures[1]),h=a.validateMeasure(s.props.measures[2]),v=[{qDef:{qDef:m}},{qDef:{qDef:c}},{qDef:{qDef:h}},{qDef:{qDef:"R.ScriptEval('set.seed(1);kmeans("+f+","+t+")$cluster', "+p+")"}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(i)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(v)}],!1),r.patchApplied=!0,null},drawChart:function(s,t){var u=r.defer(),i=s.layout;a.validateDimension(i.props.dimensions[0]);return a.pageExtensionData(s,function(r){var n=s.layout.qHyperCube.qMeasureInfo;if(isNaN(n[3].qMin)&&isNaN(n[3].qMax))a.displayConnectionError(s.extId);else{for(var p=a.getOneHundredColors(),l=[],o=1;o<=i.props.numberOfClusters;o++)l[o]=[],l[o].text=[],l[o].x=[],l[o].y=[],l[o].z=[];$.each(r,function(e,a){l[a[4].qNum].text.push(a[0].qText),l[a[4].qNum].x.push(a[1].qNum),l[a[4].qNum].y.push(a[2].qNum),l[a[4].qNum].z.push(a[3].qNum)});for(var q=[],d=1;d<=i.props.numberOfClusters;d++)q.push({x:l[d].x,y:l[d].y,z:l[d].z,text:l[d].text,name:"cluster "+d,mode:"markers",type:"scatter3d",marker:{color:"rgba("+p[d-1]+",0.7)",size:i.props.bubbleSize,opacity:.8,line:{color:"rgba("+p[d-1]+", 1)",width:1}}});$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" style="width:100%;height:100%;"></div>'),e.draw(s,t,q,"aat-chart-"+s.extId,null)}return u.resolve()}),u.promise}}});
//# sourceMappingURL=../../maps/analysis/kmeans_3d.js.map
